#include <stdio.h>

#include QMK_KEYBOARD_H

#define INDICATOR_BRIGHTNESS 30

#define HSV_OVERRIDE_HELP(h, s, v, Override) h, s, Override
#define HSV_OVERRIDE(hsv, Override) HSV_OVERRIDE_HELP(hsv, Override)

// Light combinations
#define SET_INDICATORS(hsv) \
    {0, 1, HSV_OVERRIDE_HELP(hsv, INDICATOR_BRIGHTNESS)}, { 35 + 0, 1, hsv }
#define SET_UNDERGLOW(hsv) \
    {1, 6, hsv}, { 35 + 1, 6, hsv }
#define SET_NUMPAD(hsv) \
    {35 + 15, 5, hsv}, {35 + 22, 3, hsv}, { 35 + 27, 3, hsv }
#define SET_NUMROW(hsv) \
    {10, 2, hsv}, {20, 2, hsv}, {30, 2, hsv}, {35 + 10, 2, hsv}, {35 + 20, 2, hsv}, { 35 + 30, 2, hsv }
#define SET_INNER_COL(hsv) \
    {33, 4, hsv}, { 35 + 33, 4, hsv }

#define SET_OUTER_COL(hsv) \
    {7, 4, hsv}, { 35 + 7, 4, hsv }
#define SET_THUMB_CLUSTER(hsv) \
    {25, 2, hsv}, { 35 + 25, 2, hsv }
#define SET_LAYER_ID(hsv) \
    {0, 1, HSV_OVERRIDE_HELP(hsv, INDICATOR_BRIGHTNESS)}, {35 + 0, 1, HSV_OVERRIDE_HELP(hsv, INDICATOR_BRIGHTNESS)}, {1, 6, hsv}, {35 + 1, 6, hsv}, {7, 4, hsv}, {35 + 7, 4, hsv}, {25, 2, hsv}, { 35 + 25, 2, hsv }

enum sofle_layers { _QWERTY = 0, _LOWER, _RAISE, _ADJUST, _NUMPAD };

enum custom_keycodes { KC_LOWER, KC_RAISE, KC_D_MUTE };

// clang-format off
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    /*
     * QWERTY
     * .-----------------------------------------------------------.                        .-----------------------------------------------------------.
     * |         | 1       | 2       | 3       | 4       | 5       |                        | 6       | 7       | 8       | 9       | 0       |         |
     * |---------+---------+---------+---------+---------+---------|                        |---------+---------+---------+---------+---------+---------|
     * | TAB     | Q       | W       | E       | R       | T       |                        | Y       | U       | I       | O       | P       | `       |
     * |---------+---------+---------+---------+---------+---------|                        |---------+---------+---------+---------+---------+---------|
     * | ESC     | A       | S       | D       | F       | G       |---------.   ,----------| H       | J       | K       | L       | ;       | '       |
     * |---------+---------+---------+---------+---------+---------| MUTE    |   | DISCORD  |---------+---------+---------+---------+---------+---------|
     * | LShift  | Z       | X       | C       | V       | B       |---------|   |----------| N       | M       | ,       | .       | /       | RShift  |
     * `-----------------------------------------------------------/        /     \          \----------------------------------------------------------'
     *           | LCtrl   | LAlt   | Super   | Lower   |        / Space  /       \ Enter    \       | RAISE   | Backsp. | RAlt    | RCtrl   |
     *           `--------------------------------------------------------'         '---------------------------------------------------------/
     */
    [_QWERTY] = LAYOUT(
    // .-----------------------------------------------------------.                        .-----------------------------------------------------------.
         XXXXXXX , KC_1    , KC_2    , KC_3    , KC_4    , KC_5    ,                          KC_6    , KC_7    , KC_8    , KC_9    , KC_0    , XXXXXXX ,
    // |---------+---------+---------+---------+---------+---------|                        |---------+---------+---------+---------+---------+---------|
         KC_TAB  , KC_Q    , KC_W    , KC_E    , KC_R    , KC_T    ,                          KC_Y    , KC_U    , KC_I    , KC_O    , KC_P    , KC_GRV  ,
    // |---------+---------+---------+---------+---------+---------|                        |---------+---------+---------+---------+---------+---------|
         KC_ESC  , KC_A    , KC_S    , KC_D    , KC_F    , KC_G    ,                          KC_H    , KC_J    , KC_K    , KC_L    , KC_SCLN , KC_QUOT ,
    // |---------+---------+---------+---------+---------+---------|=========|    |=========|---------+---------+---------+---------+---------+---------|
         KC_LSFT , KC_Z    , KC_X    , KC_C    , KC_V    , KC_B    , KC_MUTE ,     KC_D_MUTE, KC_N    , KC_M    , KC_COMM , KC_DOT  , KC_SLSH , KC_RSFT ,
    // |---------+---------+---------+---------+---------+---------|=========|    |=========|---------+---------+---------+---------+---------+---------|
                   KC_LCTL , KC_LALT , KC_LGUI , KC_LOWER, KC_SPC  ,                          KC_ENT  , KC_RAISE, KC_BSPC , KC_RALT , KC_RCTL
    //           \---------+---------+---------+---------+---------|--------/      \--------|---------+---------+--------+---------+---------/
    ),

    /*
     * LOWER
     * .-----------------------------------------------------------.                                     .-----------------------------------------------------------.
     * |         | F1      | F2      | F3      | F4      | F5      |                                     | F6      | F7      | F8      | F9      | F10     |         |
     * |---------+---------+---------+---------+---------+---------|                                     |---------+---------+---------+---------+---------+---------|
     * |         | F11     | F12     | F13     | F14     | F15     |                                     | F16     | F17     | F18     | F19     | F20     |         |
     * |---------+---------+---------+---------+---------+---------|                                     |---------+---------+---------+---------+---------+---------|
     * |         | !       | @       | #       | $       | %       |----------.               ,----------| ^       | &       | *       | (       | )       |         |
     * |---------+---------+---------+---------+---------+---------|          |               |          |---------+---------+---------+---------+---------+---------|
     * |         | :       | <       | [       | {       | -       |----------|               |----------| +       | }       | ]       | >       | ;       |         |
     * `-----------------------------------------------------------/         /                 \          \----------------------------------------------------------'
     *           |         |         |         |         |        /         /                   \          \       |         | Del     |         |         |
     *           `---------------------------------------------------------'                     '---------------------------------------------------------/
     */
    [_LOWER] = LAYOUT(
    // .-----------------------------------------------------------------------.                         .------------------------------------------------------------------.
         _______ , KC_F1       , KC_F2       , KC_F3   , KC_F4       , KC_F5   ,                           KC_F6   , KC_F7   , KC_F8       , KC_F9      , KC_F10  , _______ ,
    // |---------+-------------+-------------+---------+-------------+---------|                         |---------+-------------+---------+------------+---------+---------|
         _______ , KC_F11      , KC_F12      , KC_F13  , KC_F14      , KC_F15  ,                           KC_F16  , KC_F17  , KC_F18      , KC_F19     , KC_F20  , _______ ,
    // |---------+-------------+-------------+---------+-------------+---------|                         |---------+-------------+---------+------------+---------+---------|
         _______ , KC_EXLM     , KC_AT       , KC_HASH , KC_DLR      , KC_PERC ,                           KC_CIRC , KC_AMPR , KC_ASTR     , KC_LPRN    , KC_RPRN , _______ ,
    // |---------+-------------+-------------+---------+-------------+---------|=========|     |=========|---------+-------------+---------+------------+---------+---------|
         _______ ,LSFT(KC_SCLN),LSFT(KC_COMM), KC_LBRC ,LSFT(KC_LBRC), KC_MINS , _______ ,       _______ , KC_PLUS ,LSFT(KC_RBRC), KC_RBRC ,LSFT(KC_DOT), KC_SCLN , _______ ,
    // |---------+-------------+-------------+---------+-------------+---------|=========|     |=========|---------+-------------+---------+------------+---------+---------|
                   _______     , _______     , _______ , _______     , _______ ,                           _______ , _______     , KC_DEL  , _______    , _______
    //           \-------------+-------------+---------+-------------+---------|--------/       \--------|---------+-------------+---------+------------+---------/
    ),

    /* RAISE
     * .-------------------------------------------------------------------------.                         .-----------------------------------------------------------.
     * | Caps    |             |             |           |             |         |                         |         |         |         |         |         |         |
     * |---------+-------------+-------------+-----------+-------------+---------|                         |---------+---------+---------+---------+---------+---------|
     * |         | Ins         | Pscr        | Menu      |             |         |                         |         |         |         |         |         |         |
     * |---------+-------------+-------------+-----------+-------------+---------|                         |---------+---------+---------+---------+---------+---------|
     * |         | ShiftLeft   | ShiftDown   | ShiftUp   | ShiftRight  |         |----------.   ,----------| Left    | Down    | Up      | Right   |         |         |
     * |---------+-------------+-------------+-----------+-------------+---------|          |   |          |---------+---------+---------+---------+---------+---------|
     * |         | Undo        | Cut         | Copy      | Paste       |         |----------|   |----------|         |         |         |         |         |         |
     * `-------------------------------------------------------------------------/         /     \          \----------------------------------------------------------'
     *           |             |             |           |             |        /         /       \          \       |         |         |         |         |
     *           `-----------------------------------------------------------------------'         '---------------------------------------------------------/
     */
    [_RAISE] = LAYOUT(
    // .-------------------------------------------------------------------------.                         .-----------------------------------------------------------.
         KC_CAPS , XXXXXXX     , XXXXXXX     , XXXXXXX   , XXXXXXX     , XXXXXXX ,                           XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX ,
    // |---------+-------------+-------------+-----------+-------------+---------|                         |---------+---------+---------+---------+---------+---------|
         XXXXXXX , KC_INS      , KC_PSCR     , KC_APP    , XXXXXXX     , XXXXXXX ,                           XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX ,
    // |---------+-------------+-------------+-----------+-------------+---------|                         |---------+---------+---------+---------+---------+---------|
         XXXXXXX ,LSFT(KC_LEFT),LSFT(KC_DOWN),LSFT(KC_UP),LSFT(KC_RGHT), XXXXXXX ,                           KC_LEFT , KC_DOWN , KC_UP   , KC_RGHT , XXXXXXX , XXXXXXX ,
    // |---------+-------------+-------------+-----------+-------------+---------|=========|     |=========|---------+---------+---------+---------+---------+---------|
         XXXXXXX , KC_UNDO     , KC_CUT      , KC_COPY   , KC_PASTE    , XXXXXXX , XXXXXXX ,       XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX ,
    // |---------+-------------+-------------+-----------+-------------+---------|=========|     |=========|---------+---------+---------+---------+---------+---------|
                   XXXXXXX     , XXXXXXX     , XXXXXXX   , _______     , XXXXXXX ,                           XXXXXXX , _______ , XXXXXXX , XXXXXXX , XXXXXXX
    //           \-------------+-------------+-----------+-------------+---------|--------/       \--------|---------+---------+---------+---------+---------/
    ),

    /* ADJUST
     * .---------------------------------------------------------------.                         .-----------------------------------------------------------.
     * |         |         | RGB Hue-  | RGB Hue+  |         |         |                         |         |         |         |         |         |         |
     * |---------+---------+-----------+-----------+---------+---------|                         |---------+---------+---------+---------+---------+---------|
     * |         |         | RGB Sat-  | RGB Sat+  |         |         |                         |         |         |         |         |         |         |
     * |---------+---------+-----------+-----------+---------+---------|                         |---------+---------+---------+---------+---------+---------|
     * |         | RGB Prev| RGB Value-| RGB Value+| RGB Next|         |----------.   ,----------|         |         |         |         |         |         |
     * |---------+---------+-----------+-----------+---------+---------|          |   |          |---------+---------+---------+---------+---------+---------|
     * |         |         | RGB Speed-| RGB Speed+|         |         |----------|   |----------|         |         |         |         |         |         |
     * `-----------------------------------------------------------/         /     \          \----------------------------------------------------------'
     *           |         |         |         |         |        /         /       \          \       |         |         |         |         |
     *           `---------------------------------------------------------'         '---------------------------------------------------------/
     */
    [_ADJUST] = LAYOUT(
    // .-----------------------------------------------------------.                         .-----------------------------------------------------------.
         XXXXXXX , XXXXXXX , RGB_HUD , RGB_HUI , XXXXXXX , XXXXXXX ,                           XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX ,
    // |---------+---------+---------+---------+---------+---------|                         |---------+---------+---------+---------+---------+---------|
         XXXXXXX , XXXXXXX , RGB_SAD , RGB_SAI , XXXXXXX , XXXXXXX ,                           XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX ,
    // |---------+---------+---------+---------+---------+---------|                         |---------+---------+---------+---------+---------+---------|
         XXXXXXX , RGB_RMOD, RGB_VAD , RGB_VAI , RGB_MOD , XXXXXXX ,                           XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX ,
    // |---------+---------+---------+---------+---------+---------|=========|     |=========|---------+---------+---------+---------+---------+---------|
         XXXXXXX , XXXXXXX , RGB_SPD , RGB_SPI , XXXXXXX , XXXXXXX , XXXXXXX ,       XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX , XXXXXXX ,
    // |---------+---------+---------+---------+---------+---------|=========|     |=========|---------+---------+---------+---------+---------+---------|
                   XXXXXXX , XXXXXXX , XXXXXXX, XXXXXXX  , XXXXXXX ,                           XXXXXXX  , XXXXXXX  , XXXXXXX, XXXXXXX , XXXXXXX
    //           \---------+---------+---------+---------+---------|--------/       \--------|---------+---------+---------+---------+---------/
    ),

    /* NUMPAD
     * .-----------------------------------------------------------.                         .-----------------------------------------------------------.
     * |         |         |         |         |         |         |                         |         | NumLock |         |         |         |         |
     * |---------+---------+---------+---------+---------+---------|                         |---------+---------+---------+---------+---------+---------|
     * |         |         |         |         |         |         |                         | ^       | 7       | 8       | 9       | *       |         |
     * |---------+---------+---------+---------+---------+---------|                         |---------+---------+---------+---------+---------+---------|
     * |         |         |         |         |         |         |----------.   ,----------| -       | 4       | 5       | 6       | =       |         |
     * |---------+---------+---------+---------+---------+---------|          |   |          |---------+---------+---------+---------+---------+---------|
     * |         |         |         |         |         |         |----------|   |----------| +       | 1       | 2       | 3       | \       |         |
     * `-----------------------------------------------------------/         /     \          \----------------------------------------------------------'
     *           |         |         |         |         |        /         /       \          \       | ,       | 0       | .       |         |
     *           `---------------------------------------------------------'         '---------------------------------------------------------/
     */
    [_NUMPAD] = LAYOUT(
    // .-----------------------------------------------------------.                         .-----------------------------------------------------------.
         _______ , _______ , _______ , _______ , _______ , _______ ,                           _______ , KC_NUM  , _______ , _______ , _______ , _______ ,
    // |---------+---------+---------+---------+---------+---------|                         |---------+---------+---------+---------+---------+---------|
         _______ , _______ , _______ , _______ , _______ , _______ ,                           KC_CIRC , KC_P7   , KC_P8   , KC_P9   , KC_ASTR , _______ ,
    // |---------+---------+---------+---------+---------+---------|                         |---------+---------+---------+---------+---------+---------|
         _______ , _______ , _______ , _______ , _______ , _______ ,                           KC_MINS , KC_P4   , KC_P5   , KC_P6   , KC_EQL  , _______ ,
    // |---------+---------+---------+---------+---------+---------|=========|     |=========|---------+---------+---------+---------+---------+---------|
         _______ , _______ , _______ , _______ , _______ , _______ , _______ ,       _______ , KC_PLUS , KC_P1   , KC_P2   , KC_P3   , KC_SLSH , _______ ,
    // |---------+---------+---------+---------+---------+---------|=========|     |=========|---------+---------+---------+---------+---------+---------|
                   _______,OSM(MOD_MEH),_______, _______ , _______ ,                           _______ , KC_COMMA, KC_P0   , KC_PDOT , _______
    //           \---------+---------+---------+---------+---------|--------/       \--------|---------+---------+---------+---------+---------/
    ),

    /*
     * TEMPLATE
     * .-----------------------------------------------------------.                         .-----------------------------------------------------------.
     * |         |         |         |         |         |         |                         |         |         |         |         |         |         |
     * |---------+---------+---------+---------+---------+---------|                         |---------+---------+---------+---------+---------+---------|
     * |         |         |         |         |         |         |                         |         |         |         |         |         |         |
     * |---------+---------+---------+---------+---------+---------|                         |---------+---------+---------+---------+---------+---------|
     * |         |         |         |         |         |         |----------.   ,----------|         |         |         |         |         |         |
     * |---------+---------+---------+---------+---------+---------|          |   |          |---------+---------+---------+---------+---------+---------|
     * |         |         |         |         |         |         |----------|   |----------|         |         |         |         |         |         |
     * `-----------------------------------------------------------/         /     \          \----------------------------------------------------------'
     *           |         |         |         |         |        /         /       \          \       |         |         |         |         |
     *           `---------------------------------------------------------'         '---------------------------------------------------------/
    [_TEMPLATE] = LAYOUT(
    // .-----------------------------------------------------------.                         .-----------------------------------------------------------.
         _______ , _______ , _______ , _______ , _______ , _______ ,                           _______ , _______ , _______ , _______ , _______ , _______ ,
    // |---------+---------+---------+---------+---------+---------|                         |---------+---------+---------+---------+---------+---------|
         _______ , _______ , _______ , _______ , _______ , _______ ,                           _______ , _______ , _______ , _______ , _______ , _______ ,
    // |---------+---------+---------+---------+---------+---------|                         |---------+---------+---------+---------+---------+---------|
         _______ , _______ , _______ , _______ , _______ , _______ ,                           _______ , _______ , _______ , _______ , _______ , _______ ,
    // |---------+---------+---------+---------+---------+---------|=========|     |=========|---------+---------+---------+---------+---------+---------|
         _______ , _______ , _______ , _______ , _______ , _______ , _______ ,       _______ , _______ , _______ , _______ , _______ , _______ , _______ ,
    // |---------+---------+---------+---------+---------+---------|=========|     |=========|---------+---------+---------+---------+---------+---------|
                   _______ , _______ , _______, _______  , _______ ,                           _______  , _______  , _______, _______ , _______
    //           \---------+---------+---------+---------+---------|--------/       \--------|---------+---------+---------+---------+---------/
    ),
    */
};
// clang-format on

#ifdef RGBLIGHT_ENABLE
void keyboard_post_init_user(void) {
    // Enable the LED layers
    // rgblight_layers = my_rgb_layers;

    rgb_matrix_disable();
    rgb_matrix_set_speed(10);
    rgb_matrix_enable();
    rgb_matrix_sethsv(10, 10, 10);
    rgb_matrix_set_speed(10);
    rgb_matrix_mode(RGB_MATRIX_RAINBOW_MOVING_CHEVRON);
}
#endif

#ifdef OLED_ENABLE

static void render_logo(void) {
    static const char PROGMEM qmk_logo[] = {0x80, 0x81, 0x82, 0x83, 0x84, 0x85, 0x86, 0x87, 0x88, 0x89, 0x8A, 0x8B, 0x8C, 0x8D, 0x8E, 0x8F, 0x90, 0x91, 0x92, 0x93, 0x94, 0xA0, 0xA1, 0xA2, 0xA3, 0xA4, 0xA5, 0xA6, 0xA7, 0xA8, 0xA9, 0xAA, 0xAB, 0xAC, 0xAD, 0xAE, 0xAF, 0xB0, 0xB1, 0xB2, 0xB3, 0xB4, 0xC0, 0xC1, 0xC2, 0xC3, 0xC4, 0xC5, 0xC6, 0xC7, 0xC8, 0xC9, 0xCA, 0xCB, 0xCC, 0xCD, 0xCE, 0xCF, 0xD0, 0xD1, 0xD2, 0xD3, 0xD4, 0x00};

    oled_write_P(qmk_logo, false);
}

static void print_status_narrow(void) {
    oled_clear();
    switch (get_highest_layer(layer_state)) {
        case _ADJUST: {
            char mode[4];
            char val[4];
            char hue[4];
            char sat[4];
            char speed[4];
            sprintf(mode, "%d", rgb_matrix_get_mode());
            sprintf(val, "%d", rgb_matrix_get_val());
            sprintf(hue, "%d", rgb_matrix_get_hue());
            sprintf(sat, "%d", rgb_matrix_get_sat());
            sprintf(speed, "%d", rgb_matrix_get_speed());

            oled_write_ln_P(PSTR("Mode"), false);
            oled_write_ln(mode, false);
            oled_write_P(PSTR("Value"), false);
            oled_write_ln(val, false);
            oled_write_ln_P(PSTR("Hue"), false);
            oled_write_ln(hue, false);
            oled_write_ln_P(PSTR("Sat"), false);
            oled_write_ln(sat, false);
            oled_write_P(PSTR("Speed"), false);
            oled_write(speed, false);
        } break;
        default: {
            oled_write_ln_P(PSTR("LAYER"), false);
            switch (get_highest_layer(layer_state)) {
                case _RAISE:
                    oled_write_ln_P(PSTR("Raise"), false);
                    break;
                case _LOWER:
                    oled_write_ln_P(PSTR("Lower"), false);
                    break;
                case _ADJUST:
                    oled_write_ln_P(PSTR("Adj."), false);
                    break;
                case _NUMPAD:
                    oled_write_ln_P(PSTR("Num."), false);
                    break;
                default:
                    oled_write_ln_P(PSTR("Undef"), false);
            }

            oled_write_P(PSTR("\n\n"), false);

            oled_write_P(PSTR("WPM: "), false);
            oled_write(get_u8_str(get_current_wpm(), '0'), false);
        } break;
    }
}

oled_rotation_t oled_init_user(oled_rotation_t rotation) {
    if (is_keyboard_master()) {
        return OLED_ROTATION_270;
    }
    return rotation;
}

bool oled_task_user(void) {
    if (is_keyboard_master()) {
        print_status_narrow();
    } else {
        render_logo();
    }
    return false;
}

#endif

bool process_record_user(uint16_t keycode, keyrecord_t* record) {
    switch (keycode) {
        case KC_LOWER: {
            if (record->event.pressed) {
                layer_on(_LOWER);
                update_tri_layer(_LOWER, _RAISE, _ADJUST);
            } else {
                layer_off(_LOWER);
                update_tri_layer(_LOWER, _RAISE, _ADJUST);
            }
            return false;
        }
        case KC_RAISE: {
            if (record->event.pressed) {
                layer_on(_RAISE);
                update_tri_layer(_LOWER, _RAISE, _ADJUST);
            } else {
                layer_off(_RAISE);
                update_tri_layer(_LOWER, _RAISE, _ADJUST);
            }
            return false;
        }
        case KC_D_MUTE: {
            if (record->event.pressed) {
                register_mods(mod_config(MOD_MEH));
                register_code(KC_UP);
            } else {
                unregister_mods(mod_config(MOD_MEH));
                unregister_code(KC_UP);
            }
        }
    }
    return true;
}

#ifdef ENCODER_ENABLE

bool encoder_update_user(uint8_t index, bool clockwise) {
    if (index == 0) {
        if (clockwise) {
            rgblight_decrease_val();
        } else {
            rgblight_increase_val();
        }
    } else if (index == 1) {
        switch (get_highest_layer(layer_state)) {
            case _QWERTY: {
                if (clockwise) {
                    tap_code(KC_PGDN);
                } else {
                    tap_code(KC_PGUP);
                }
            } break;
            case _RAISE:
            case _LOWER: {
                if (clockwise) {
                    tap_code(KC_DOWN);
                } else {
                    tap_code(KC_UP);
                }
            } break;
            case _ADJUST: {
                if (clockwise) {
                    tap_code(KC_AUDIO_VOL_UP);
                } else {
                    tap_code(KC_AUDIO_VOL_DOWN);
                }
            } break;
            default: {
                if (clockwise) {
                    tap_code(KC_WH_D);
                } else {
                    tap_code(KC_WH_U);
                }
            } break;
        }
    }
    return true;
}

#endif
